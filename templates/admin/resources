@app.route("/admin/resources", methods=["GET", "POST"])
def admin_resources():
    if not session.get("admin_logged_in"):
        return redirect("/admin/login")

    conn = get_db()
    cursor = conn.cursor()

    # Handle new resource
    if request.method == "POST":
    title = request.form["title"]
    resource_type = request.form["resource_type"]
    url = request.form["url"]
    description = request.form["description"]
    category = request.form["category"]
    updated_at = datetime.now().strftime("%b %d, %Y")

    cursor.execute(
        """
        INSERT INTO resources (title, resource_type, url, description, category, updated_at)
        VALUES (%s, %s, %s, %s, %s, %s)
        """,
        (title, resource_type, url, description, category, updated_at)
    )
    conn.commit()

    # Fetch resources
    cursor.execute(
        """
        SELECT id, title, resource_type, url, description
        FROM resources
        ORDER BY id DESC
        """
    )
    resources = cursor.fetchall()

    conn.close()
    return render_template("admin_resources.html", resources=resources)

{% extends "admin_base.html" %}

{% block title %}Admin – Resources{% endblock %}

{% block content %}
<h1>Manage Resources</h1>

<!-- ADD RESOURCE FORM -->
<form method="POST">
  <h3>Add New Resource</h3>

  <label>Title</label>
  <input type="text" name="title" required>

  <label>Resource Type</label>
  <select name="resource_type" required>
    <option value="pdf">PDF</option>
    <option value="article">Article</option>
    <option value="video">Video</option>
  </select>

  <label>Resource URL</label>
  <input type="url" name="url" placeholder="https://..." required>

  <label>Description (optional)</label>
  <textarea name="description"></textarea>

  <button type="submit">Add Resource</button>
</form>

<hr style="margin:40px 0;">

<!-- RESOURCE LIST -->
<h3>Existing Resources</h3>

{% if resources %}
  {% for r in resources %}
    <div class="card">
      <strong>{{ r[1] }}</strong>
      <p>{{ r[4] }}</p>

      <small>
        Type: {{ r[2] }} ·
        <a href="{{ r[3] }}" target="_blank">Open link</a>
      </small>
    </div>
  {% endfor %}
{% else %}
  <p>No resources added yet.</p>
{% endif %}

{% endblock %}
